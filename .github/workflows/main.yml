
name: Hexo Auto-Deploy
on: [push]


jobs:
  build:
    name: Hexo Auto-Deploy by GitHub Actions
    runs-on: ubuntu-latest

    steps:
    - name: 1. git checkout...
      uses: actions/checkout@v1
      
    - name: 2. setup nodejs...
      uses: actions/setup-node@v1
    

    - name: 3. install hexo...
      run: |
        npm install hexo-cli -g
        npm install
        
    - name: 4. hexo generate public files...
      run: |
        hexo clean
        hexo g  

    - name: 5. hexo deploy ...
      env:
        GH_REF: github.com/p709723778/p709723778.github.io.git # GitHub 仓库 SSH 地址
        GH_TOKEN: 52cd21678ec65e14238f4976723b1bf0206b31ac #${{ secrets.GH_TOKEN }} # 预先生成 GitHub Token 
        run: |
          git config --global user.name "Soto.Pu"
          git config --global user.email "p709723778@126.com"
          git clone https://${GH_REF} .deploy_git
          cd .deploy_git
          git checkout master
          cd ../
          mv .deploy_git/.git/ ./public/
          cd ./public/
          git add .
          git commit -m "CI built at `date +"%Y-%m-%d %H:%M:%S"`"
          git push --force --quiet "https://${GH_TOKEN}@${GH_REF}" master:master
